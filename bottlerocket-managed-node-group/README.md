# Bottlerocket Managed Node Group

## Overview

Deploys an [EKS managed node group](https://docs.aws.amazon.com/eks/latest/userguide/managed-node-groups.html) containing instances running the [Bottlerocket OS](https://github.com/bottlerocket-os/bottlerocket).  The nodes are configured to[block access to the instance metadata](https://aws.github.io/aws-eks-best-practices/security/docs/iam/#restrict-access-to-the-instance-profile-assigned-to-the-worker-node).  Therefore, any pods that run on a node and requires access to the AWS API MUST USE [IAM roles for service accounts](https://docs.aws.amazon.com/eks/latest/userguide/)iam-roles-for-service-accounts.html).  he module creates a launch template to customize instance metadata, volume sizes, and tagging.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 4.50.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 4.50.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_eks_node_group.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_node_group) | resource |
| [aws_launch_template.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_template) | resource |
| [aws_default_tags.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/default_tags) | data source |
| [aws_ec2_instance_type.desired](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ec2_instance_type) | data source |
| [aws_ec2_instance_type_offerings.node](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ec2_instance_type_offerings) | data source |
| [aws_ssm_parameter.ami_release_version](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ssm_parameter) | data source |
| [aws_subnet.node](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/subnet) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_bottlerocket_version"></a> [bottlerocket\_version](#input\_bottlerocket\_version) | The version of Bottlerocket to deploy in the node group.  The value must be either the string 'latest' to always deploy the latest version available<br>for the EKS cluster version or the semantic version string of a Bottlerocket release.  Available versions can be found at<br>https://github.com/bottlerocket-os/bottlerocket/release or in public SSM parameters as described at<br>https://docs.aws.amazon.com/eks/latest/userguide/eks-optimized-ami-bottlerocket.html | `string` | `"latest"` | no |
| <a name="input_capacity_type"></a> [capacity\_type](#input\_capacity\_type) | Configures the node group's capacity type.  Valid values are 'on-demand' and 'spot'. | `string` | `"on-demand"` | no |
| <a name="input_container_registry_mirrors"></a> [container\_registry\_mirrors](#input\_container\_registry\_mirrors) | A list of objects for configuring containerd registry mirrors.<br><br>The 'registry' attribute is the hostname of the upstream registry.<br>The 'endpoint' attrbute is the URL of the mirror.<br><br>https://github.com/bottlerocket-os/bottlerocket#container-image-registry-settings<br>https://github.com/containerd/containerd/blob/main/docs/hosts.md#setup-a-local-mirror-for-docker | <pre>list(object(<br>    {<br>      endpoint = string<br>      registry = string<br>    }<br>  ))</pre> | `[]` | no |
| <a name="input_eks_cluster"></a> [eks\_cluster](#input\_eks\_cluster) | Attributes of the EKS cluster on which Karpenter is deployed.  The names of the attributes match the names of outputs in the eks-cluster module to allow using the module as the argument to this variable.<br><br>The `cluster_name` attribute the the name of the EKS cluster.  It is required.<br>The `cluster_security_group_id` is the ID of the security group generated by EKS when the cluster was created.  It is required.<br>The `k8s_version` is the Kubernetes version of the cluster's control plane.  It is required. | <pre>object({<br>    cluster_name              = string<br>    cluster_security_group_id = string<br>    k8s_version               = string<br>  })</pre> | n/a | yes |
| <a name="input_iam_role_arn"></a> [iam\_role\_arn](#input\_iam\_role\_arn) | The ARN of the IAM role the nodes will assume. | `string` | n/a | yes |
| <a name="input_instance_types"></a> [instance\_types](#input\_instance\_types) | The instance types used for the nodes in the group.  Multiple types can be specified to minimze the impact of<br>insufficient instance capacity in an availability zone.<br>https://docs.aws.amazon.com/autoscaling/ec2/userguide/ec2-auto-scaling-mixed-instances-groups.html<br>https://docs.aws.amazon.com/eks/latest/userguide/security-groups-for-pods.html#supported-instance-types<br>https://docs.aws.amazon.com/eks/latest/userguide/choosing-instance-type.html | `set(string)` | n/a | yes |
| <a name="input_labels"></a> [labels](#input\_labels) | Key-value map of Kubernetes labels to assign to every node. | `map(string)` | `{}` | no |
| <a name="input_name_prefix"></a> [name\_prefix](#input\_name\_prefix) | The value to use as the prefix of the name of the AWS resources created for the managed node group. | `string` | n/a | yes |
| <a name="input_security_group_ids"></a> [security\_group\_ids](#input\_security\_group\_ids) | An optional list of the unique identifiers of additional security groups to attach to the nodes' ENIs. | `list(string)` | `[]` | no |
| <a name="input_size"></a> [size](#input\_size) | The minimum, maximum, and desired size of the autoscaling group that manages the nodes. | <pre>object(<br>    {<br>      desired = number<br>      max     = number<br>      min     = number<br>    }<br>  )</pre> | <pre>{<br>  "desired": 1,<br>  "max": 1,<br>  "min": 1<br>}</pre> | no |
| <a name="input_subnet_ids"></a> [subnet\_ids](#input\_subnet\_ids) | The unique identifiers of the subnets where the nodes will launch. | `list(string)` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | An optional map of AWS tags to attach to every resource created by the module. | `map(string)` | `{}` | no |
| <a name="input_taints"></a> [taints](#input\_taints) | The Kubernetes taints to be applied to the nodes in the node group. Maximum of 50 taints per node group.<br>For more details, see https://docs.aws.amazon.com/eks/latest/userguide/node-taints-managed-node-groups.html. | <pre>list(object({<br>    key    = string<br>    value  = string<br>    effect = string<br>  }))</pre> | `[]` | no |
| <a name="input_volume_iops"></a> [volume\_iops](#input\_volume\_iops) | The IOPS of the root volume of every node in the node group. | `number` | `3000` | no |
| <a name="input_volume_size"></a> [volume\_size](#input\_volume\_size) | The size, in gigabytes, of the root volume of every node in the node group. | `number` | `1024` | no |
| <a name="input_volume_throughput"></a> [volume\_throughput](#input\_volume\_throughput) | The throughput of the root volume of every node in the node group. | `number` | `125` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_launch_template_arn"></a> [launch\_template\_arn](#output\_launch\_template\_arn) | The ARN of the launch template created by the module. |
| <a name="output_launch_template_id"></a> [launch\_template\_id](#output\_launch\_template\_id) | The id of the launch template created by the module. |
| <a name="output_node_group_arn"></a> [node\_group\_arn](#output\_node\_group\_arn) | The ARN of the node group created by the module. |
| <a name="output_node_group_name"></a> [node\_group\_name](#output\_node\_group\_name) | The name of the node group created by the module. |
<!-- END_TF_DOCS -->