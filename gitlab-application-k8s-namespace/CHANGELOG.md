# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## Unreleased

## 2.1.0

### Added

- The Gitlab CI role is now able to manage resources for Flagger, Prometheus Operator, and Sealed Secrets.  See the module README file for the full set of supported resources.

## 2.0.0

### Added

- The `path` and `name` attributes have been added to the `application_iam_role` variable to allow callers to customize the IAM role's path and name components, respectively.
- The Kubernetes role bound to the tokens generated by the Gitlab Kubernetes agent has been modified to allow access to [the `status`](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status) and [`scale`](https://github.com/kubernetes/kubernetes/blob/release-1.2/docs/design/horizontal-pod-autoscaler.md#scale-subresource) sub-resources.  Tools like Helm require access to these sub-resources to determine if resources are deployed successfully.

### Changed

- **Breaking Change**: The minimum Terraform version supported by the module is now 1.5.
- **Breaking Change**: The minimum Kubernetes provider version supported by the module is now 2.23.

### Removed

- **Breaking Change**: Removed all resources related to Gitlab's cert-based Kubernetes integration.  The Gitlab Kubernetes Agent is now the only supported method for creating resources in the namespace via a CI/CD pipeline.

## 1.3.0

### Added

- The module now supports the [Gitlab Kubernetes Agent](https://docs.gitlab.com/ee/user/clusters/agent/install/index.html).  Kubernetes RBAC resources have been added to enable [the agent's CI/CD integration](https://docs.gitlab.com/ee/user/clusters/agent/ci_cd_workflow.html#use-gitlab-cicd-with-your-cluster) and [user access integration](https://docs.gitlab.com/ee/user/clusters/agent/user_access.html).   The new RBAC resources allow the agent to use [Kubernetes impersonation](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation) to provide least-privilege access to the cluster.  For the CI/CD integration, a custom Kubernetes role has been added.  Its contains rules for manage resources deployed by the [Auto DevOps Helm chart](https://gitlab.com/gitlab-org/cluster-integration/auto-deploy-image/-/tree/master/assets/auto-deploy-app?ref_type=heads).  Additional rules can be added with the new `additional_ci_cd_role_rules` variable.  The resources for Gitlab's certificate-based cluster integration have not been removed.

## 1.2.1

### Fixed

- Removed `automount_service_account_token = false` from the `application` service account.  The Gitlab auto DevOps Helm chart does not set the `automountServiceAccountToken` attribute nor does it provide a way to set it.  If the attribute is not set on the deployment, then any explicit setting on the service account takes effect.  The result is that the `application` service account was unusable.

## 1.2.0

### Added

- The `gitlab-cilium-role` Kubernetes role and its corresponding binding have been added to the module.

## 1.1.0

### Added

- The `iam_role_path` output has been added for future proofing and easier integration with the [eks-iam-role-for-service-account module](../eks-iam-role-for-service-account).
- The `iam_role_arn` output has been added to allow the role to be referenced before it has been created.

## 1.0.0

### Added

- Initial release
